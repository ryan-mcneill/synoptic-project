{"ast":null,"code":"import axios from \"axios\";\nimport { FETCH_ARTISTS, FETCH_ARTISTS_FAILURE, FETCH_ARTISTS_SUCCESS } from \"../types\";\n\nconst fetchArtistsAction = () => ({\n  type: FETCH_ARTISTS\n});\n\nconst fetchArtistsFailure = error => ({\n  type: FETCH_ARTISTS_FAILURE,\n  payload: {\n    error\n  }\n});\n\nconst fetchArtistsSuccess = artists => ({\n  type: FETCH_ARTISTS_SUCCESS,\n  payload: artists\n});\n\nexport const fetchArtists = () => {\n  return dispatch => {\n    dispatch(fetchArtistsAction());\n    axios.get(`/api/artists`).then(artistsResponse => {\n      Promise.all(artistsResponse.data.map(artist => axios.get(`/api/songs/artist/${artist._id}`).then(songResponse => songResponse.data))).then(songs => {\n        const flatSongs = songs.reduce((acc, curr) => {\n          acc = { ...acc,\n            ...curr\n          };\n          return acc;\n        }, {});\n        const artistsData = artistsResponse.data.reduce((acc, {\n          _id,\n          name\n        }) => {\n          acc = { ...acc,\n            [_id]: {\n              name,\n              songs: flatSongs[_id]\n            }\n          };\n          return acc;\n        }, {});\n        dispatch(fetchArtistsSuccess(artistsData));\n      }).catch(err => {\n        dispatch(fetchArtistsFailure(err.message));\n      });\n    }).catch(err => {\n      dispatch(fetchArtistsFailure(err.message));\n    });\n  };\n};","map":{"version":3,"sources":["/Users/mcneillr/personal/synoptic-project/packages/app/src/store/actions/artistsActions.ts"],"names":["axios","FETCH_ARTISTS","FETCH_ARTISTS_FAILURE","FETCH_ARTISTS_SUCCESS","fetchArtistsAction","type","fetchArtistsFailure","error","payload","fetchArtistsSuccess","artists","fetchArtists","dispatch","get","then","artistsResponse","Promise","all","data","map","artist","_id","songResponse","songs","flatSongs","reduce","acc","curr","artistsData","name","catch","err","message"],"mappings":"AAAA,OAAOA,KAAP,MAAqC,OAArC;AAEA,SAEEC,aAFF,EAGEC,qBAHF,EAIEC,qBAJF,QASO,UATP;;AAWA,MAAMC,kBAAqD,GAAG,OAAO;AACnEC,EAAAA,IAAI,EAAEJ;AAD6D,CAAP,CAA9D;;AAIA,MAAMK,mBAA6D,GACjEC,KADoE,KAEhE;AACJF,EAAAA,IAAI,EAAEH,qBADF;AAEJM,EAAAA,OAAO,EAAE;AAAED,IAAAA;AAAF;AAFL,CAFgE,CAAtE;;AAOA,MAAME,mBAA6D,GACjEC,OADoE,KAEhE;AACJL,EAAAA,IAAI,EAAEF,qBADF;AAEJK,EAAAA,OAAO,EAAEE;AAFL,CAFgE,CAAtE;;AAOA,OAAO,MAAMC,YAAY,GAAG,MAAM;AAChC,SAAQC,QAAD,IAAwB;AAC7BA,IAAAA,QAAQ,CAACR,kBAAkB,EAAnB,CAAR;AAEAJ,IAAAA,KAAK,CACFa,GADH,CACQ,cADR,EAEGC,IAFH,CAESC,eAAD,IAA4C;AAChDC,MAAAA,OAAO,CAACC,GAAR,CACEF,eAAe,CAACG,IAAhB,CAAqBC,GAArB,CAA0BC,MAAD,IACvBpB,KAAK,CACFa,GADH,CACQ,qBAAoBO,MAAM,CAACC,GAAI,EADvC,EAEGP,IAFH,CAESQ,YAAD,IAAkBA,YAAY,CAACJ,IAFvC,CADF,CADF,EAOGJ,IAPH,CAOSS,KAAD,IAAW;AACf,cAAMC,SAAS,GAAGD,KAAK,CAACE,MAAN,CAAa,CAACC,GAAD,EAAMC,IAAN,KAAe;AAC5CD,UAAAA,GAAG,GAAG,EAAE,GAAGA,GAAL;AAAU,eAAGC;AAAb,WAAN;AACA,iBAAOD,GAAP;AACD,SAHiB,EAGf,EAHe,CAAlB;AAKA,cAAME,WAAW,GAAGb,eAAe,CAACG,IAAhB,CAAqBO,MAArB,CAClB,CAACC,GAAD,EAAU;AAAEL,UAAAA,GAAF;AAAOQ,UAAAA;AAAP,SAAV,KAA0C;AACxCH,UAAAA,GAAG,GAAG,EAAE,GAAGA,GAAL;AAAU,aAACL,GAAD,GAAO;AAAEQ,cAAAA,IAAF;AAAQN,cAAAA,KAAK,EAAEC,SAAS,CAACH,GAAD;AAAxB;AAAjB,WAAN;AACA,iBAAOK,GAAP;AACD,SAJiB,EAKlB,EALkB,CAApB;AAOAd,QAAAA,QAAQ,CAACH,mBAAmB,CAACmB,WAAD,CAApB,CAAR;AACD,OArBH,EAsBGE,KAtBH,CAsBUC,GAAD,IAAS;AACdnB,QAAAA,QAAQ,CAACN,mBAAmB,CAACyB,GAAG,CAACC,OAAL,CAApB,CAAR;AACD,OAxBH;AAyBD,KA5BH,EA6BGF,KA7BH,CA6BUC,GAAD,IAAS;AACdnB,MAAAA,QAAQ,CAACN,mBAAmB,CAACyB,GAAG,CAACC,OAAL,CAApB,CAAR;AACD,KA/BH;AAgCD,GAnCD;AAoCD,CArCM","sourcesContent":["import axios, { AxiosResponse } from \"axios\";\nimport { ActionCreator, Dispatch } from \"redux\";\nimport {\n  BasicDetails,\n  FETCH_ARTISTS,\n  FETCH_ARTISTS_FAILURE,\n  FETCH_ARTISTS_SUCCESS,\n  FetchArtistsAction,\n  FetchArtistsFailureAction,\n  FetchArtistsSuccessAction,\n  Song\n} from \"../types\";\n\nconst fetchArtistsAction: ActionCreator<FetchArtistsAction> = () => ({\n  type: FETCH_ARTISTS\n});\n\nconst fetchArtistsFailure: ActionCreator<FetchArtistsFailureAction> = (\n  error\n) => ({\n  type: FETCH_ARTISTS_FAILURE,\n  payload: { error }\n});\n\nconst fetchArtistsSuccess: ActionCreator<FetchArtistsSuccessAction> = (\n  artists\n) => ({\n  type: FETCH_ARTISTS_SUCCESS,\n  payload: artists\n});\n\nexport const fetchArtists = () => {\n  return (dispatch: Dispatch) => {\n    dispatch(fetchArtistsAction());\n\n    axios\n      .get(`/api/artists`)\n      .then((artistsResponse: AxiosResponse<Song[]>) => {\n        Promise.all(\n          artistsResponse.data.map((artist: BasicDetails) =>\n            axios\n              .get(`/api/songs/artist/${artist._id}`)\n              .then((songResponse) => songResponse.data)\n          )\n        )\n          .then((songs) => {\n            const flatSongs = songs.reduce((acc, curr) => {\n              acc = { ...acc, ...curr };\n              return acc;\n            }, {});\n\n            const artistsData = artistsResponse.data.reduce(\n              (acc: {}, { _id, name }: BasicDetails) => {\n                acc = { ...acc, [_id]: { name, songs: flatSongs[_id] } };\n                return acc;\n              },\n              {}\n            );\n            dispatch(fetchArtistsSuccess(artistsData));\n          })\n          .catch((err) => {\n            dispatch(fetchArtistsFailure(err.message));\n          });\n      })\n      .catch((err) => {\n        dispatch(fetchArtistsFailure(err.message));\n      });\n  };\n};\n"]},"metadata":{},"sourceType":"module"}