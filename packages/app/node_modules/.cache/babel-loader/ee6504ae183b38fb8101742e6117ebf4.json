{"ast":null,"code":"import axios from \"axios\";\nimport { FETCH_ALBUMS, FETCH_ALBUMS_FAILURE, FETCH_ALBUMS_SUCCESS } from \"../types\";\n\nconst fetchAlbumsAction = () => ({\n  type: FETCH_ALBUMS\n});\n\nconst fetchAlbumsFailure = error => ({\n  type: FETCH_ALBUMS_FAILURE,\n  payload: {\n    error\n  }\n});\n\nconst fetchAlbumsSuccess = albums => ({\n  type: FETCH_ALBUMS_SUCCESS,\n  payload: albums\n});\n\nexport const fetchAlbums = () => {\n  return dispatch => {\n    dispatch(fetchAlbumsAction());\n    axios.get(`/api/albums`).then(albumResponse => {\n      Promise.all(albumResponse.data.map(album => axios.get(`/api/songs/album/${album._id}`).then(songResponse => ({\n        [album._id]: songResponse.data\n      }))).flat()).then(songs => {\n        const flattenSongs = songs.concat();\n        let albumsData = albumResponse.data.reduce((acc, {\n          _id,\n          name\n        }) => {\n          console.log(flattenSongs);\n          console.log(_id);\n          acc = { ...acc,\n            //@ts-ignore\n            [_id]: {\n              name,\n              songs: songs[_id]\n            }\n          };\n          return acc;\n        }, {});\n        dispatch(fetchAlbumsSuccess(albumsData));\n      }).catch(err => {\n        dispatch(fetchAlbumsFailure(err.message));\n      });\n    }).catch(err => {\n      dispatch(fetchAlbumsFailure(err.message));\n    });\n  };\n};","map":{"version":3,"sources":["/Users/mcneillr/personal/synoptic-project/packages/app/src/store/actions/albumsActions.ts"],"names":["axios","FETCH_ALBUMS","FETCH_ALBUMS_FAILURE","FETCH_ALBUMS_SUCCESS","fetchAlbumsAction","type","fetchAlbumsFailure","error","payload","fetchAlbumsSuccess","albums","fetchAlbums","dispatch","get","then","albumResponse","Promise","all","data","map","album","_id","songResponse","flat","songs","flattenSongs","concat","albumsData","reduce","acc","name","console","log","catch","err","message"],"mappings":"AAAA,OAAOA,KAAP,MAAqC,OAArC;AAEA,SAEEC,YAFF,EAGEC,oBAHF,EAIEC,oBAJF,QASO,UATP;;AAWA,MAAMC,iBAAmD,GAAG,OAAO;AACjEC,EAAAA,IAAI,EAAEJ;AAD2D,CAAP,CAA5D;;AAIA,MAAMK,kBAA2D,GAC/DC,KADkE,KAE9D;AACJF,EAAAA,IAAI,EAAEH,oBADF;AAEJM,EAAAA,OAAO,EAAE;AAAED,IAAAA;AAAF;AAFL,CAF8D,CAApE;;AAOA,MAAME,kBAA2D,GAC/DC,MADkE,KAE9D;AACJL,EAAAA,IAAI,EAAEF,oBADF;AAEJK,EAAAA,OAAO,EAAEE;AAFL,CAF8D,CAApE;;AAOA,OAAO,MAAMC,WAAW,GAAG,MAAM;AAC/B,SAAQC,QAAD,IAAwB;AAC7BA,IAAAA,QAAQ,CAACR,iBAAiB,EAAlB,CAAR;AAEAJ,IAAAA,KAAK,CACFa,GADH,CACQ,aADR,EAEGC,IAFH,CAESC,aAAD,IAA0C;AAC9CC,MAAAA,OAAO,CAACC,GAAR,CACEF,aAAa,CAACG,IAAd,CACGC,GADH,CACQC,KAAD,IACHpB,KAAK,CACFa,GADH,CACQ,oBAAmBO,KAAK,CAACC,GAAI,EADrC,EAEGP,IAFH,CAESQ,YAAD,KAAmB;AAAE,SAACF,KAAK,CAACC,GAAP,GAAaC,YAAY,CAACJ;AAA5B,OAAnB,CAFR,CAFJ,EAMGK,IANH,EADF,EASGT,IATH,CASSU,KAAD,IAAW;AACf,cAAMC,YAAY,GAAGD,KAAK,CAACE,MAAN,EAArB;AACA,YAAIC,UAAU,GAAGZ,aAAa,CAACG,IAAd,CAAmBU,MAAnB,CACf,CAACC,GAAD,EAAU;AAAER,UAAAA,GAAF;AAAOS,UAAAA;AAAP,SAAV,KAAkC;AAChCC,UAAAA,OAAO,CAACC,GAAR,CAAYP,YAAZ;AACAM,UAAAA,OAAO,CAACC,GAAR,CAAYX,GAAZ;AACAQ,UAAAA,GAAG,GAAG,EACJ,GAAGA,GADC;AAEJ;AACA,aAACR,GAAD,GAAO;AAAES,cAAAA,IAAF;AAAQN,cAAAA,KAAK,EAAEA,KAAK,CAACH,GAAD;AAApB;AAHH,WAAN;AAKA,iBAAOQ,GAAP;AACD,SAVc,EAWf,EAXe,CAAjB;AAaAjB,QAAAA,QAAQ,CAACH,kBAAkB,CAACkB,UAAD,CAAnB,CAAR;AACD,OAzBH,EA0BGM,KA1BH,CA0BUC,GAAD,IAAS;AACdtB,QAAAA,QAAQ,CAACN,kBAAkB,CAAC4B,GAAG,CAACC,OAAL,CAAnB,CAAR;AACD,OA5BH;AA6BD,KAhCH,EAiCGF,KAjCH,CAiCUC,GAAD,IAAS;AACdtB,MAAAA,QAAQ,CAACN,kBAAkB,CAAC4B,GAAG,CAACC,OAAL,CAAnB,CAAR;AACD,KAnCH;AAoCD,GAvCD;AAwCD,CAzCM","sourcesContent":["import axios, { AxiosResponse } from \"axios\";\nimport { ActionCreator, Dispatch } from \"redux\";\nimport {\n  BasicDetails,\n  FETCH_ALBUMS,\n  FETCH_ALBUMS_FAILURE,\n  FETCH_ALBUMS_SUCCESS,\n  FetchAlbumsAction,\n  FetchAlbumsFailureAction,\n  FetchAlbumsSuccessAction,\n  Song\n} from \"../types\";\n\nconst fetchAlbumsAction: ActionCreator<FetchAlbumsAction> = () => ({\n  type: FETCH_ALBUMS\n});\n\nconst fetchAlbumsFailure: ActionCreator<FetchAlbumsFailureAction> = (\n  error\n) => ({\n  type: FETCH_ALBUMS_FAILURE,\n  payload: { error }\n});\n\nconst fetchAlbumsSuccess: ActionCreator<FetchAlbumsSuccessAction> = (\n  albums\n) => ({\n  type: FETCH_ALBUMS_SUCCESS,\n  payload: albums\n});\n\nexport const fetchAlbums = () => {\n  return (dispatch: Dispatch) => {\n    dispatch(fetchAlbumsAction());\n\n    axios\n      .get(`/api/albums`)\n      .then((albumResponse: AxiosResponse<Song[]>) => {\n        Promise.all(\n          albumResponse.data\n            .map((album: BasicDetails) =>\n              axios\n                .get(`/api/songs/album/${album._id}`)\n                .then((songResponse) => ({ [album._id]: songResponse.data }))\n            )\n            .flat()\n        )\n          .then((songs) => {\n            const flattenSongs = songs.concat();\n            let albumsData = albumResponse.data.reduce(\n              (acc: {}, { _id, name }: Song) => {\n                console.log(flattenSongs);\n                console.log(_id);\n                acc = {\n                  ...acc,\n                  //@ts-ignore\n                  [_id]: { name, songs: songs[_id] }\n                };\n                return acc;\n              },\n              {}\n            );\n            dispatch(fetchAlbumsSuccess(albumsData));\n          })\n          .catch((err) => {\n            dispatch(fetchAlbumsFailure(err.message));\n          });\n      })\n      .catch((err) => {\n        dispatch(fetchAlbumsFailure(err.message));\n      });\n  };\n};\n"]},"metadata":{},"sourceType":"module"}